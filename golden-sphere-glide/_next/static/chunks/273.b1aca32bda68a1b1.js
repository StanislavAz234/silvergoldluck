"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[273],{9273:function(e,t,r){r.r(t),r.d(t,{CanvasRoot:function(){return M}});var a=r(5893),n=r(7188),l=r(7294),s=r(4795),i=r(1133),o=r(4480),c=r(8755);r(3454);let u="default";var p=r(9542);let f=e=>{let t=null;return(Math.random()>.66&&(t="static"),t||(t=Math.random()>.25?"fall":"gap"),t===e)?f(e):t},h=e=>{let t,r=0,a=1,n="vertical",l="right",s=Math.min(5+e,100),i=0,o=[];for(;i<s;){let s;("gap"===t||e<5)&&(s="gap");let c=f(s);switch(t=c,c){case"static":let u="vertical"===n?(0,p.rO)(1,3):1,h="horizontal"===n?(0,p.rO)(1,3):1,y="horizontal"!==n?0:"right"===l?0:-(h-1);o.push({type:c,x:r+y,z:a,sizeX:h,sizeZ:u}),a+="vertical"!==n?0:u,r+="horizontal"!==n?0:"right"===l?h:-h;break;case"fall":o.push({type:c,x:r,z:a}),a+="vertical"!==n?0:1,r+="horizontal"!==n?0:1;break;case"gap":let m="vertical"!==n?0:(0,p.rO)(1,2),d="horizontal"!==n?0:"right"===l?(0,p.rO)(1,2):-(0,p.rO)(1,2);a+=m,r+=d}"vertical"==(n="vertical"===n?Math.random()>.4?"vertical":"horizontal":"vertical")&&(l=Math.random()>.5?"left":"right"),i++}return{sectors:o,finish:{type:"finish",x:r,z:a}}};var y=r(9477),m=r(5769),d=r(9730),x=r(9948);let g=(0,l.forwardRef)((e,t)=>{let[,r]=(0,o.FV)(c.Sr),[n,p]=(0,i.Eo)(()=>({type:"Dynamic",mass:1,material:u,position:[0,1,0],linearDamping:.15,angularDamping:.25}),(0,l.useRef)(null));(0,l.useImperativeHandle)(t,()=>n.current,[n]);let{camera:f}=(0,s.z)(),h=(0,l.useRef)([0,1,0]),g=(0,l.useContext)(x.U),j=(0,d.q)();(0,l.useEffect)(()=>{f.position.set(0,4,9),f.lookAt(h.current[0],h.current[1],h.current[2])},[f]),(0,l.useEffect)(()=>{let e=p.position.subscribe(e=>{h.current=e});return e},[p]);let v=(0,l.useRef)(new y.Vector3);(0,s.A)((e,t)=>{h.current[1]>-2.5?f.position.lerp(v.current.set(h.current[0]+0,h.current[1]+4,h.current[2]+9),10*t):f.lookAt(h.current[0],h.current[1],h.current[2]),h.current[1]<-12.5&&(new Audio("./sound/fail.mp3").play(),r(c.D2.lost));let{forward:a,left:n,right:l,back:s}=j(),i=[0,0,0];a&&p.applyImpulse([0,0,-.45],i),s&&p.applyImpulse([0,0,.45],i),n&&p.applyImpulse([-.45,0,0],i),l&&p.applyImpulse([.45,0,0],i);let{x:o,y:u}=g.current;(o||u)&&(o=o||0,u=u?-u:0,p.applyImpulse([.45*o,0,.45*u],i))});let w=(0,m.m)("./texture-ball.png",e=>{Array.isArray(e)||(e.wrapS=y.RepeatWrapping,e.wrapT=y.RepeatWrapping,e.repeat.set(1,4))});return(0,a.jsxs)("mesh",{ref:n,receiveShadow:!0,castShadow:!0,children:[(0,a.jsx)("sphereGeometry",{}),(0,a.jsx)("meshStandardMaterial",{map:w,color:"silver"})]})});g.displayName="Player";let j=e=>{let t="start"===e.type?0:e.x,r="start"===e.type?0:e.z,n="static"!==e.type?1:e.sizeX,f="static"!==e.type?1:e.sizeZ,h=[4*n,.75,4*f],y=[4*t+4*(n-1)*.5,-2,-(4*r)-4*(f-1)*.5],m=(0,o.Zl)(c.Sr),d=(0,l.useRef)(!1),[x,g]=(0,i.EJ)(()=>({allowSleep:!0,args:h,material:u,type:"Kinematic",position:y,onCollideBegin:t=>{let{body:r}=t;if(!d.current&&r===e.playerRef.current){if(d.current=!0,"finish"===e.type){setTimeout(()=>{new Audio("./sound/win.mp3").play(),m(c.D2.won)},200);return}"fall"===e.type&&(g.angularVelocity.set((0,p.Qy)(-Math.PI/12,Math.PI/12),0,(0,p.Qy)(-Math.PI/18,Math.PI/18)),setTimeout(()=>{new Audio("./sound/lose.mp3").play(),g.velocity.set(0,(0,p.Qy)(-25,-20),0),g.angularVelocity.set((0,p.Qy)(0,Math.PI),(0,p.Qy)(0,Math.PI),(0,p.Qy)(0,Math.PI))},500))}}}),(0,l.useRef)(null)),j=(0,l.useRef)(y);(0,l.useEffect)(()=>{let e=g.position.subscribe(e=>{j.current=e});return e},[g]),(0,s.A)(()=>{j.current[1]>-50||e.onDestroy()}),(0,s.A)(t=>{let{clock:r}=t;"moving"===e.type&&g.position.set(y[0]+4*Math.sin(e.shift+2*r.getElapsedTime()),j.current[1],j.current[2])});let v="#FBFBF2";return"start"===e.type?v="#3B99FC":"finish"===e.type?v="#10a37f":"fall"===e.type&&(v="#a62929"),(0,a.jsxs)("mesh",{ref:x,receiveShadow:!0,children:[(0,a.jsx)("boxGeometry",{args:h}),(0,a.jsx)("meshStandardMaterial",{color:v})]})},v=e=>{let[t,r]=(0,l.useState)(!1);return t?null:(0,a.jsx)(j,{onDestroy:()=>r(!0),...e})},w=()=>{let e=(0,l.useRef)(null),t=(0,o.sJ)(c.Sr),r=t===c.D2.playing,n=(0,o.sJ)(c.W9),i=(0,o.sJ)(c.U3),{sectors:u,finish:p}=(0,l.useMemo)(()=>{let e=h(n);return e},[i,n]),{camera:f}=(0,s.z)();return(0,l.useEffect)(()=>{f.position.set(0,4,9),f.lookAt(0,0,0)},[f,n,i]),(0,a.jsxs)(a.Fragment,{children:[r&&(0,a.jsx)(g,{ref:e}),(0,a.jsx)(v,{playerRef:e,type:"start"}),u.map(t=>{let l="".concat(r,"_").concat(n,"_").concat(i,"_").concat(t.x,"_").concat(t.z);return(0,a.jsx)(v,{playerRef:e,...t},l)}),(0,a.jsx)(v,{playerRef:e,type:"finish",x:p.x,z:p.z},"".concat(r,"_").concat(n,"_").concat(i,"_").concat(p.x,"_").concat(p.z))]})},R=()=>((0,i.VZ)(u,u,{restitution:.01,friction:.8,frictionEquationStiffness:1e9,frictionEquationRelaxation:3,contactEquationStiffness:1e9,contactEquationRelaxation:10}),null),z=()=>{let e=l.Fragment;return(0,a.jsx)(i.wI,{children:(0,a.jsxs)(e,{children:[(0,a.jsx)(R,{}),(0,a.jsx)(w,{})]})})},M=()=>(0,a.jsxs)(n.Xz,{camera:{position:[0,4,9]},children:[(0,a.jsx)("ambientLight",{intensity:.9}),(0,a.jsx)(z,{})]})}}]);